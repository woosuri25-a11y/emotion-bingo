<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Meter Chat ğŸŒˆ</title>
    <style>
        /* ê¸°ì¡´ CSSëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤. */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .app-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            text-align: center;
            padding: 20px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .screen {
            display: none;
            padding: 30px;
            min-height: 400px;
            text-align: center; /* ì¶”ê°€: ì¤‘ì•™ ì •ë ¬ */
        }

        .screen.active {
            display: block;
        }

        .room-code-screen {
            text-align: center;
        }

        .code-input {
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px;
            width: 200px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .mood-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px auto; /* autoë¡œ ë³€ê²½í•˜ì—¬ ì¤‘ì•™ ì •ë ¬ */
            max-width: 600px;
        }

        .mood-item {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex; /* ì¶”ê°€: í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            flex-direction: column; /* ì¶”ê°€: í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            justify-content: center; /* ì¶”ê°€: í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            align-items: center; /* ì¶”ê°€: í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
            min-height: 60px; /* ì¶”ê°€: ì¼ê´€ëœ ë†’ì´ */
        }

        .mood-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .mood-item.selected {
            border-color: #ff6b6b;
            background: #fff5f5;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); /* ì¶”ê°€: ì„ íƒ íš¨ê³¼ ê°•í™” */
        }

        .mood-item.high-energy.high-pleasant { background: linear-gradient(135deg, #ffd54f, #ff8a65); } /* Yellow */
        .mood-item.high-energy.low-pleasant { background: linear-gradient(135deg, #ff7043, #d32f2f); color: white; } /* Red */
        .mood-item.low-energy.high-pleasant { background: linear-gradient(135deg, #a5d6a7, #66bb6a); } /* Green */
        .mood-item.low-energy.low-pleasant { background: linear-gradient(135deg, #90a4ae, #546e7a); color: white; } /* Blue */

        .prediction-section, .response-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto; /* autoë¡œ ë³€ê²½í•˜ì—¬ ì¤‘ì•™ ì •ë ¬ */
            max-width: 600px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
        }

        .prediction-item {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
            text-align: left; /* í…ìŠ¤íŠ¸ ì¢Œì¸¡ ì •ë ¬ */
        }

        .because-input {
            width: calc(100% - 20px); /* íŒ¨ë”© ê³ ë ¤ */
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 1rem;
            resize: vertical;
            min-height: 60px;
            box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ */
        }

        .response-section {
            background: #e8f5e8;
        }

        .match-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 10px;
            font-weight: bold; /* ì¶”ê°€ */
        }

        .match-correct {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .match-incorrect {
            background: #ffcdd2;
            color: #c62828;
        }

        .support-message {
            background: linear-gradient(135deg, #e1bee7, #f8bbd9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            text-align: center;
            max-width: 600px;
        }

        .role-indicator {
            background: linear-gradient(45deg, #42a5f5, #66bb6a);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
        }

        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            margin: 20px auto; /* ì¤‘ì•™ ì •ë ¬ */
            width: 80%; /* ë„ˆë¹„ ì„¤ì • */
            max-width: 500px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            height: 100%;
            transition: width 0.5s ease;
        }

        h2, h3, h4, p {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .mood-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .mood-item {
                font-size: 0.8rem;
                padding: 8px;
                min-height: 50px; /* ëª¨ë°”ì¼ì—ì„œ ë†’ì´ ì¡°ì • */
            }
            
            .app-container {
                width: 95%;
                margin: 10px;
            }

            .connection-status {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        ğŸŸ¢ Ready to Connect
    </div>

    <div class="app-container">
        <div class="header">
            <h1>ğŸŒˆ Mood Meter Chat</h1>
            <p>ì¹œêµ¬ì˜ ê°ì •ì„ ë§ì¶°ë³´ì„¸ìš”!</p>
        </div>

        <div class="screen active" id="roomCodeScreen">
            <div class="room-code-screen">
                <h2>ğŸšª ë°© ì…ì¥í•˜ê¸°</h2>
                <p>ì¹œêµ¬ì™€ í•¨ê»˜ ì‚¬ìš©í•  ê°„ë‹¨í•œ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ABC123)</p>
                <input type="text" class="code-input" id="roomCodeInput" placeholder="ì½”ë“œ ì…ë ¥" maxlength="6">
                <br>
                <button class="btn" onclick="joinRoom()">ì…ì¥í•˜ê¸° ğŸš€</button>
                <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    ğŸ’¡ íŒ: ì¹œêµ¬ì™€ ê°™ì€ ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ í•¨ê»˜ ëŒ€í™”í•  ìˆ˜ ìˆì–´ìš”!
                </div>
            </div>
        </div>

        <div class="screen" id="moodSelectionScreen">
            <div class="role-indicator" id="roleIndicator">
                ğŸ¯ ë‹¹ì‹ ì€ ì˜ˆì¸¡ìì…ë‹ˆë‹¤
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 25%"></div>
            </div>

            <h2>ğŸ¤” ì¹œêµ¬ì˜ ê°ì •ì„ ì˜ˆì¸¡í•´ë³´ì„¸ìš”</h2>
            <p>ì¹œêµ¬ê°€ ì§€ê¸ˆ ëŠë¼ê³  ìˆì„ ê²ƒ ê°™ì€ ê°ì •ì„ **3ê°œ** ì„ íƒí•˜ì„¸ìš”.</p>
            
            <div class="mood-grid" id="moodGrid">
                </div>

            <div style="text-align: center; margin-top: 20px;">
                <span id="selectionCount">0</span>/3 ê°œ ì„ íƒë¨
                <br><br>
                <button class="btn" id="continueBtn" onclick="generatePredictions()" disabled>ì˜ˆì¸¡ ë¬¸ì¥ ë§Œë“¤ê¸° âœ¨</button>
            </div>
        </div>

        <div class="screen" id="predictionScreen">
            <div class="role-indicator">
                ğŸ’­ ì¹œêµ¬ì˜ ê°ì •ì„ ì˜ˆì¸¡í•´ë³´ì„¸ìš”
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 50%"></div>
            </div>

            <h2>ğŸ“ ì˜ˆì¸¡ ë¬¸ì¥ ì™„ì„±í•˜ê¸°</h2>
            <p>ì„ íƒí•œ ê°ì •ì— ë§ì¶° ì¹œêµ¬ì˜ ëª¨ìŠµì„ ìƒìƒí•˜ë©° ì´ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
            <div class="prediction-section" id="predictionSection">
                </div>

            <button class="btn" onclick="sendPredictions()">ì¹œêµ¬ì—ê²Œ ë³´ë‚´ê¸° ğŸ’Œ</button>
        </div>

        <div class="screen" id="responseScreen">
            <div class="role-indicator">
                ğŸ’ ì¹œêµ¬ì˜ ì˜ˆì¸¡ì— ë‹µí•´ë³´ì„¸ìš”
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 75%"></div>
            </div>

            <h2>ğŸ­ ì¹œêµ¬ê°€ ì˜ˆì¸¡í•œ ë‚˜ì˜ ê°ì •</h2>
            <div id="receivedPredictions" class="prediction-section" style="text-align: left;">
                </div>

            <h3>ë‚´ê°€ ì •ë§ë¡œ ëŠë¼ëŠ” ê°ì • **3ê°œ**ë¥¼ ì„ íƒí•˜ê³  ì´ìœ ë¥¼ ì‘ì„±í•˜ì„¸ìš”.</h3>
            <div class="mood-grid" id="responseMoodGrid">
                </div>

            <div class="response-section">
                <h4>ë‚˜ì˜ ê°ì • ì´ìœ :</h4>
                <textarea class="because-input" id="myFeelingsReason" placeholder="I feel this way because..."></textarea>
            </div>

            <button class="btn" onclick="sendResponse()">ë‹µë³€ ë³´ë‚´ê¸° ğŸ’•</button>
        </div>

        <div class="screen" id="resultsScreen">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 100%"></div>
            </div>

            <h2>ğŸ‰ ê²°ê³¼ í™•ì¸í•˜ê¸°</h2>
            <div id="resultsContent">
                </div>

            <div class="support-message">
                <h3>ğŸ’™ ì„œë¡œë¥¼ ì‘ì›í•´ìš”!</h3>
                <p>ì¹œêµ¬ì—ê²Œ ë”°ëœ»í•œ ì‘ì›ì˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
                <textarea class="because-input" id="supportMessage" placeholder="ì¹œêµ¬ì—ê²Œ ì‘ì›ì˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea>
                <button class="btn" id="sendSupportBtn" onclick="sendSupport()" style="margin-top: 10px;">ì‘ì› ë©”ì‹œì§€ ë³´ë‚´ê¸° ğŸŒŸ</button>
            </div>

            <button class="btn" onclick="startNewChat()">ìƒˆë¡œìš´ ëŒ€í™” ì‹œì‘í•˜ê¸° ğŸ”„</button>
        </div>
    </div>

    <script>
        // Mood data based on the mood meter (ê¸°ì¡´ ë°ì´í„° ìœ ì§€)
        const moodData = {
            // High Energy, High Pleasant (Yellow)
            'ecstatic': { kr: 'í™©í™€í•œ', energy: 'high', pleasant: 'high' },
            'elated': { kr: 'ì˜ê¸°ì–‘ì–‘í•œ', energy: 'high', pleasant: 'high' },
            'jubilant': { kr: 'ì´ì£¼ ì‹ ë‚˜ëŠ”', energy: 'high', pleasant: 'high' },
            'enthusiastic': { kr: 'ì—´ê´‘í•˜ëŠ”', energy: 'high', pleasant: 'high' },
            'lively': { kr: 'í™œë°œí•œ', energy: 'high', pleasant: 'high' },
            'upbeat': { kr: 'ê¸ì •ì ì¸', energy: 'high', pleasant: 'high' },
            'cheerful': { kr: 'ì¾Œí™œí•œ', energy: 'high', pleasant: 'high' },
            'motivated': { kr: 'ë™ê¸°ë¶€ì—¬ëœ', energy: 'high', pleasant: 'high' },
            'inspired': { kr: 'ì˜ê°ì„ ë°›ì€', energy: 'high', pleasant: 'high' },
            'optimistic': { kr: 'ë‚™ê´€ì ì¸', energy: 'high', pleasant: 'high' },
            'energized': { kr: 'ê¸°ìš´ì´ ë„˜ì¹˜ëŠ”', energy: 'high', pleasant: 'high' },
            'excited': { kr: 'í¥ë¶„í•œ', energy: 'high', pleasant: 'high' },
            'festive': { kr: 'í¥ê²¨ìš´', energy: 'high', pleasant: 'high' },
            'focused': { kr: 'ì§‘ì¤‘í•˜ëŠ”', energy: 'high', pleasant: 'high' },
            'happy': { kr: 'í–‰ë³µí•œ', energy: 'high', pleasant: 'high' },
            'proud': { kr: 'ìë‘ìŠ¤ëŸ¬ìš´', energy: 'high', pleasant: 'high' },
            'thrilled': { kr: 'ì§œë¦¿í•œ', energy: 'high', pleasant: 'high' },
            'playful': { kr: 'ì¬ë¯¸ìˆëŠ”', energy: 'high', pleasant: 'high' },
            'blissful': { kr: 'ë”ì—†ì´ í–‰ë³µí•œ', energy: 'high', pleasant: 'high' },

            // High Energy, Low Pleasant (Red)
            'enraged': { kr: 'ê²©ë¶„í•œ', energy: 'high', pleasant: 'low' },
            'furious': { kr: 'ë¶„ë…¸í•œ', energy: 'high', pleasant: 'low' },
            'angry': { kr: 'í™”ë‚œ', energy: 'high', pleasant: 'low' },
            'nervous': { kr: 'ì´ˆì¡°í•œ', energy: 'high', pleasant: 'low' },
            'restless': { kr: 'ì•ˆì ˆë¶€ì ˆí•œ', energy: 'high', pleasant: 'low' },
            'hyper': { kr: 'ë“¤ëœ¬', energy: 'high', pleasant: 'low' },
            'worried': { kr: 'ê·¼ì‹¬í•˜ëŠ”', energy: 'high', pleasant: 'low' },
            'annoyed': { kr: 'ì§œì¦ë‚˜ëŠ”', energy: 'high', pleasant: 'low' },
            'frustrated': { kr: 'ì¢Œì ˆí•œ', energy: 'high', pleasant: 'low' },
            'tense': { kr: 'ê¸´ì¥í•œ', energy: 'high', pleasant: 'low' },
            'shocked': { kr: 'ì¶©ê²©ë°›ì€', energy: 'high', pleasant: 'low' },
            'stunned': { kr: 'ë§ì—°ìì‹¤í•œ', energy: 'high', pleasant: 'low' },
            'surprised': { kr: 'ë†€ë€', energy: 'high', pleasant: 'low' },
            'panicked': { kr: 'ê³µí™©ìƒíƒœì˜', energy: 'high', pleasant: 'low' },
            'stressed': { kr: 'ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ëŠ”', energy: 'high', pleasant: 'low' },
            'overwhelmed': { kr: 'ì••ë„ë‹¹í•œ', energy: 'high', pleasant: 'low' },
            'livid': { kr: 'ê²©ë…¸í•œ', energy: 'high', pleasant: 'low' },
            'irate': { kr: 'í™”ê°€ ì¹˜ë¯¼', energy: 'high', pleasant: 'low' },
            'apprehensive': { kr: 'ìš°ë ¤í•˜ëŠ”', energy: 'high', pleasant: 'low' },

            // Low Energy, High Pleasant (Green)
            'fulfilled': { kr: 'ì¶©ë§Œí•œ', energy: 'low', pleasant: 'high' },
            'content': { kr: 'ìì¡±í•˜ëŠ”', energy: 'low', pleasant: 'high' },
            'loving': { kr: 'ë‹¤ì •í•œ', energy: 'low', pleasant: 'high' },
            'grateful': { kr: 'ê°ì‚¬í•˜ëŠ”', energy: 'low', pleasant: 'high' },
            'touched': { kr: 'ê°ë™ë°›ì€', energy: 'low', pleasant: 'high' },
            'blessed': { kr: 'ì¶•ë³µë°›ì€', energy: 'low', pleasant: 'high' },
            'balanced': { kr: 'ì•ˆì •ëœ', energy: 'low', pleasant: 'high' },
            'comfortable': { kr: 'í¸ì•ˆí•œ', energy: 'low', pleasant: 'high' },
            'carefree': { kr: 'ê·¼ì‹¬ ê±±ì • ì—†ëŠ”', energy: 'low', pleasant: 'high' },
            'at ease': { kr: 'ì‰½í¸í•œ', energy: 'low', pleasant: 'high' },
            'easygoing': { kr: 'íƒœí‰í•œ', energy: 'low', pleasant: 'high' },
            'satisfied': { kr: 'ë§Œì¡±ìŠ¤ëŸ¬ìš´', energy: 'low', pleasant: 'high' },
            'secure': { kr: 'ì•ˆì „í•œ', energy: 'low', pleasant: 'high' },
            'calm': { kr: 'í‰ì˜¨í•œ', energy: 'low', pleasant: 'high' },
            'restful': { kr: 'í¸ì•ˆí•œ', energy: 'low', pleasant: 'high' },
            'chill': { kr: 'ì°¨ë¶„í•œ', energy: 'low', pleasant: 'high' },
            'thoughtful': { kr: 'ìƒê°ì— ì ê¸´', energy: 'low', pleasant: 'high' },
            'peaceful': { kr: 'í‰í™”ë¡œìš´', energy: 'low', pleasant: 'high' },
            'cozy': { kr: 'ì•ˆë½í•œ', energy: 'low', pleasant: 'high' },
            'serene': { kr: 'ì•ˆì˜¨í•œ', energy: 'low', pleasant: 'high' },

            // Low Energy, Low Pleasant (Blue)
            'disgusted': { kr: 'ì—­ê²¨ìš´', energy: 'low', pleasant: 'low' },
            'glum': { kr: 'ì¹¨ìš¸í•œ', energy: 'low', pleasant: 'low' },
            'disappointed': { kr: 'ì‹¤ë§ìŠ¤ëŸ¬ìš´', energy: 'low', pleasant: 'low' },
            'down': { kr: 'ì˜ìš• ì—†ëŠ”', energy: 'low', pleasant: 'low' },
            'apathetic': { kr: 'ëƒ‰ë‹´í•œ', energy: 'low', pleasant: 'low' },
            'morose': { kr: 'ì‹œë¬´ë£©í•œ', energy: 'low', pleasant: 'low' },
            'sad': { kr: 'ìŠ¬í”ˆ', energy: 'low', pleasant: 'low' },
            'bored': { kr: 'ì§€ë£¨í•œ', energy: 'low', pleasant: 'low' },
            'tired': { kr: 'í”¼ê³¤í•œ', energy: 'low', pleasant: 'low' },
            'depressed': { kr: 'ìš°ìš¸í•œ', energy: 'low', pleasant: 'low' },
            'sullen': { kr: 'ëš±í•œ', energy: 'low', pleasant: 'low' },
            'exhausted': { kr: 'ê¸°ì§„ë§¥ì§„í•œ', energy: 'low', pleasant: 'low' },
            'fatigued': { kr: 'ì§€ì¹œ', energy: 'low', pleasant: 'low' },
            'sleepy': { kr: 'ë‚˜ë¥¸í•œ', energy: 'low', pleasant: 'low' },
            'compliant': { kr: 'ìˆœì¢…ì ì¸', energy: 'low', pleasant: 'low' },
            'tranquil': { kr: 'ê³ ìš”í•œ', energy: 'low', pleasant: 'low' },
            // 'cozy'ì™€ 'serene'ì´ low-energy, high-pleasantì— ì¤‘ë³µë˜ì–´ ìˆì–´ ì‚­ì œí•©ë‹ˆë‹¤.
        };

        // App state
        let currentRoom = '';
        let selectedMoods = []; // ì‚¬ìš©ìê°€ ì„ íƒí•œ ê°ì • (ì˜ˆì¸¡ ë˜ëŠ” ì‘ë‹µ)
        let predictions = []; // ì˜ˆì¸¡ìê°€ ì¹œêµ¬ì—ê²Œ ë³´ë‚¼ ì˜ˆì¸¡ ë¬¸ì¥
        let isPredictor = true; // í˜„ì¬ ì‚¬ìš©ìê°€ ì˜ˆì¸¡ìì¸ì§€ ì‘ë‹µìì¸ì§€
        let partnerPredictions = []; // ì¹œêµ¬ë¡œë¶€í„° ë°›ì€ ì˜ˆì¸¡
        let myResponse = {}; // ë‚´ê°€ ì„ íƒí•œ ê°ì •ê³¼ ì´ìœ 

        // Example reasons for because clauses
        const becauseExamples = [
            "your eyes look tired",
            "you're smiling brightly",
            "you're sitting up straight",
            "your shoulders look relaxed",
            "you're wearing colorful clothes",
            "you have a frown on your face",
            "you're looking down",
            "your hands are clenched",
            "you seem to be moving slowly",
            "you're bouncing in your seat",
            "you're speaking quickly",
            "you're very quiet today",
            "you're humming a tune",
            "you're fidgeting a lot",
            "you look ready for anything"
        ];

        // Helper function to show and hide screens
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function generateMoodGrid(containerId, selectable = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            // ëª¨ë“  ê°ì •ì„ ë¬´ì‘ìœ„ë¡œ ì„ì–´ì„œ í‘œì‹œ
            const shuffledMoods = Object.keys(moodData).sort(() => 0.5 - Math.random());

            shuffledMoods.forEach(mood => {
                const data = moodData[mood];
                const item = document.createElement('div');
                item.className = `mood-item ${data.energy}-energy ${data.pleasant}-pleasant`;
                item.innerHTML = `<strong>${mood}</strong><br><span style="font-size: 0.8em;">${data.kr}</span>`;
                
                if (selectable) {
                    item.onclick = () => toggleMoodSelection(mood, item, containerId); // containerId ì „ë‹¬
                }
                
                container.appendChild(item);
            });
        }

        function toggleMoodSelection(mood, element, containerId) {
            let currentSelections = [];
            // í˜„ì¬ í™œì„±í™”ëœ í™”ë©´ì˜ mood-gridì—ì„œ ì„ íƒëœ í•­ëª©ë“¤ì„ ê°€ì ¸ì˜´
            const currentGrid = document.getElementById(containerId);
            currentGrid.querySelectorAll('.mood-item.selected').forEach(item => {
                currentSelections.push(item.querySelector('strong').textContent);
            });

            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                currentSelections = currentSelections.filter(m => m !== mood);
            } else if (currentSelections.length < 3) {
                element.classList.add('selected');
                currentSelections.push(mood);
            }
            
            // selectedMoods ë³€ìˆ˜ë¥¼ í˜„ì¬ í™”ë©´ì˜ ì„ íƒìœ¼ë¡œ ì—…ë°ì´íŠ¸
            selectedMoods = currentSelections;
            updateSelectionUI(containerId); // containerId ì „ë‹¬
        }

        function updateSelectionUI(containerId) {
            const countElement = document.getElementById('selectionCount');
            const continueBtn = document.getElementById('continueBtn');
            
            // ì˜ˆì¸¡ì í™”ë©´ì¼ ë•Œë§Œ ì—…ë°ì´íŠ¸
            if (containerId === 'moodGrid') {
                if (countElement) {
                    countElement.textContent = selectedMoods.length;
                }
                if (continueBtn) {
                    continueBtn.disabled = selectedMoods.length !== 3;
                }
            }
        }

        function joinRoom() {
            const code = document.getElementById('roomCodeInput').value.trim().toUpperCase(); // ì½”ë“œë¥¼ ëŒ€ë¬¸ìë¡œ ë³€í™˜
            if (code.length < 3 || code.length > 6) {
                alert('ì½”ë“œëŠ” 3ê¸€ìì—ì„œ 6ê¸€ì ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            currentRoom = code;
            
            // ì‹¤ì œ ë°±ì—”ë“œ ì—†ì´ ì‹œë®¬ë ˆì´ì…˜:
            // ì´ ë¶€ë¶„ì—ì„œ íŠ¹ì • ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ ì˜ˆì¸¡ì/ì‘ë‹µì ì—­í• ì´ ì •í•´ì§€ê±°ë‚˜,
            // ì§ì´ ë§ì¶°ì§€ëŠ” ë¡œì§ì´ í•„ìš”í•˜ì§€ë§Œ, í˜„ì¬ëŠ” UI íë¦„ì„ ìœ„í•´ ì„ì˜ë¡œ ì§€ì •.
            // ì§ì´ ì—°ê²°ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³ , isPredictorë¥¼ ëœë¤ìœ¼ë¡œ ì„¤ì •.
            isPredictor = Math.random() < 0.5; // 50% í™•ë¥ ë¡œ ì˜ˆì¸¡ì ë˜ëŠ” ì‘ë‹µì

            document.getElementById('connectionStatus').innerHTML = `ğŸŸ¢ ${currentRoom}ë°©ì— ì—°ê²°ë¨`;
            
            if (isPredictor) {
                showScreen('moodSelectionScreen');
                generateMoodGrid('moodGrid');
                selectedMoods = []; // ê°ì • ì„ íƒ ì´ˆê¸°í™”
                updateSelectionUI('moodGrid');
            } else {
                // ì‘ë‹µìëŠ” ì¹œêµ¬ì˜ ì˜ˆì¸¡ì„ ê¸°ë‹¤ë¦¬ëŠ” í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™
                alert('ì¹œêµ¬ì˜ ê°ì • ì˜ˆì¸¡ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...');
                // ì‹¤ì œ ì•±ì—ì„œëŠ” ì¹œêµ¬ê°€ ì˜ˆì¸¡ì„ ë³´ë‚´ë©´ ì´ í™”ë©´ìœ¼ë¡œ ì „í™˜
                // ì—¬ê¸°ì„œëŠ” 1ì´ˆ í›„ ì¹œêµ¬ê°€ ì˜ˆì¸¡ì„ ë³´ëƒˆë‹¤ê³  ê°€ì •
                setTimeout(() => {
                    simulateReceivePredictions();
                }, 2000); // 2ì´ˆ í›„ ì˜ˆì¸¡ ë°›ê¸° ì‹œë®¬ë ˆì´ì…˜
            }
            updateRoleIndicator();
        }

        function updateRoleIndicator() {
            const indicator = document.getElementById('roleIndicator');
            if (document.getElementById('moodSelectionScreen').classList.contains('active')) {
                indicator.innerHTML = 'ğŸ¯ ë‹¹ì‹ ì€ ì˜ˆì¸¡ìì…ë‹ˆë‹¤';
            } else if (document.getElementById('responseScreen').classList.contains('active')) {
                indicator.innerHTML = 'ğŸ’ ë‹¹ì‹ ì€ ì‘ë‹µìì…ë‹ˆë‹¤';
            } else if (document.getElementById('predictionScreen').classList.contains('active')) {
                 indicator.innerHTML = 'ğŸ’­ ì¹œêµ¬ì˜ ê°ì •ì„ ì˜ˆì¸¡í•´ë³´ì„¸ìš”';
            }
        }

        function generatePredictions() {
            if (selectedMoods.length !== 3) {
                alert('ê°ì •ì„ 3ê°œ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            predictions = [];
            const section = document.getElementById('predictionSection');
            section.innerHTML = '';
            
            selectedMoods.forEach((mood, index) => {
                const randomExample = becauseExamples[Math.floor(Math.random() * becauseExamples.length)];
                const div = document.createElement('div');
                div.className = 'prediction-item';
                div.innerHTML = `
                    <h4>${index + 1}. You look ${mood} (${moodData[mood].kr})</h4>
                    <div style="margin: 10px 0;">
                        <strong>because</strong>
                        <textarea class="because-input" id="reason${index}" placeholder="ì˜ˆ: ${randomExample}"></textarea>
                    </div>
                `;
                section.appendChild(div);
            });
            
            showScreen('predictionScreen');
            updateRoleIndicator();
        }

        function sendPredictions() {
            let allReasonsFilled = true;
            predictions = selectedMoods.map((mood, index) => {
                const reasonInput = document.getElementById(`reason${index}`);
                const reason = reasonInput.value.trim();
                if (!reason) {
                    allReasonsFilled = false;
                }
                return {
                    mood: mood,
                    korean: moodData[mood].kr,
                    reason: reason || reasonInput.placeholder.replace('ì˜ˆ: ', '') // placeholderê°€ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ê¸°ë³¸ê°’ìœ¼ë¡œ
                };
            });

            if (!allReasonsFilled) {
                if (!confirm('ì•„ì§ ì´ìœ ë¥¼ ëª¨ë‘ ì‘ì„±í•˜ì§€ ì•Šì•˜ì–´ìš”. ì´ëŒ€ë¡œ ë³´ë‚´ì‹œê² ì–´ìš”?')) {
                    return;
                }
            }
            
            alert('ì¹œêµ¬ì—ê²Œ ì˜ˆì¸¡ì„ ë³´ëƒˆìŠµë‹ˆë‹¤! ì¹œêµ¬ì˜ ë‹µë³€ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ğŸ˜Š');
            
            // ì‹¤ì œ ì•±ì—ì„œëŠ” ì´ ë°ì´í„°ë¥¼ ì¹œêµ¬ì—ê²Œ ì „ì†¡ (WebSockets ë“±)
            // ì—¬ê¸°ì„œëŠ” ì¹œêµ¬ê°€ ì˜ˆì¸¡ì„ ë°›ì•˜ë‹¤ê³  ê°€ì •í•˜ê³ , 1ì´ˆ í›„ ì‘ë‹µ í™”ë©´ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                simulateReceivePredictions();
            }, 2000); // 2ì´ˆ í›„ ì‘ë‹µ í™”ë©´ìœ¼ë¡œ ì „í™˜
            
            // ì˜ˆì¸¡ì í™”ë©´ì—ì„œ ì‘ë‹µì í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ëŒ€ì‹ , ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í™”ë©´ìœ¼ë¡œ ì „í™˜
            // ë˜ëŠ” ì¹œêµ¬ê°€ ì‘ë‹µí•˜ë©´ ìë™ìœ¼ë¡œ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ë¡œì§ í•„ìš”
            // í˜„ì¬ëŠ” ë°ëª¨ë¥¼ ìœ„í•´ ë°”ë¡œ ì‹œë®¬ë ˆì´ì…˜
            // showScreen('waitingForResponseScreen'); // ì´ëŸ° ì¤‘ê°„ í™”ë©´ì´ ìˆë‹¤ë©´ ì¢‹ê² ì£ .
        }

        // ì¹œêµ¬ë¡œë¶€í„° ì˜ˆì¸¡ì„ ë°›ì•˜ë‹¤ê³  ì‹œë®¬ë ˆì´ì…˜
        function simulateReceivePredictions() {
            // isPredictor ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆì¸¡ì„ ë°›ëŠ” ì£¼ì²´ë¥¼ ê²°ì •
            if (!isPredictor) { // ë‚´ê°€ ì‘ë‹µìì¼ ë•Œ ì¹œêµ¬ì˜ ì˜ˆì¸¡ì„ ë°›ìŒ
                // ì¹œêµ¬ê°€ ë³´ëƒˆì„ ë²•í•œ 3ê°€ì§€ ë¬´ì‘ìœ„ ê°ì • ì„ íƒ
                const availableMoods = Object.keys(moodData);
                const shuffledAvailableMoods = availableMoods.sort(() => 0.5 - Math.random());
                
                partnerPredictions = shuffledAvailableMoods.slice(0, 3).map(mood => ({
                    mood: mood,
                    korean: moodData[mood].kr,
                    reason: becauseExamples[Math.floor(Math.random() * becauseExamples.length)]
                }));

                showResponseScreen();
            } else { // ë‚´ê°€ ì˜ˆì¸¡ìì¼ ë•Œ ì¹œêµ¬ì˜ ì‘ë‹µì„ ë°›ìŒ (ì´ í•¨ìˆ˜ëŠ” simulateReceivePredictionsByPredictor ë“±ìœ¼ë¡œ ë¶„ë¦¬ë  ìˆ˜ ìˆìŒ)
                // ì˜ˆì¸¡ìê°€ ì¹œêµ¬ì˜ ì‘ë‹µì„ ë°›ëŠ” ê²½ìš°
                // ì¹œêµ¬ì˜ ì‹¤ì œ ê°ì • (ë‚˜ì™€ ë‹¤ë¥¸ ë¬´ì‘ìœ„ ê°ì •)ì„ ì‹œë®¬ë ˆì´ì…˜
                const availableMoods = Object.keys(moodData);
                const shuffledAvailableMoods = availableMoods.filter(mood => !predictions.some(p => p.mood === mood)).sort(() => 0.5 - Math.random()); // ë‚´ ì˜ˆì¸¡ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ
                
                myResponse = {
                    moods: shuffledAvailableMoods.slice(0, 3).map(mood => ({
                        mood: mood,
                        korean: moodData[mood].kr
                    })),
                    reason: "I had a great day because I played with my cat!" // ì„ì˜ì˜ ì´ìœ 
                };
                showResults(); // ë°”ë¡œ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™
            }
        }


        function showResponseScreen() {
            const container = document.getElementById('receivedPredictions');
            container.innerHTML = `
                <h3>ì¹œêµ¬ê°€ ì˜ˆì¸¡í•œ ë‚˜ì˜ ê°ì •:</h3>
                <p>ì¹œêµ¬ê°€ ë‹¹ì‹ ì˜ ê°ì •ì„ ì´ë ‡ê²Œ ì˜ˆì¸¡í–ˆì–´ìš”. ê³¼ì—° ë§ì„ê¹Œìš”?</p>
            `;
            
            partnerPredictions.forEach((pred, index) => {
                const div = document.createElement('div');
                div.className = 'prediction-item';
                div.innerHTML = `
                    <p><strong>${index + 1}. You look ${pred.mood}</strong> (${pred.korean})</p>
                    <p style="margin-top: 5px; color: #666;"><em>because ${pred.reason}</em></p>
                `;
                container.appendChild(div);
            });
            
            generateMoodGrid('responseMoodGrid');
            selectedMoods = []; // ì‘ë‹µì ê°ì • ì„ íƒì„ ìœ„í•œ ì´ˆê¸°í™”
            updateSelectionUI('responseMoodGrid'); // ì‘ë‹µ í™”ë©´ ê°ì • ì„ íƒ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('myFeelingsReason').value = ''; // ì´ìœ  ì…ë ¥ ì´ˆê¸°í™”

            showScreen('responseScreen');
            updateRoleIndicator();
        }

        function sendResponse() {
            if (selectedMoods.length !== 3) {
                alert('ë‚´ê°€ ëŠë¼ëŠ” ê°ì • 3ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const myReason = document.getElementById('myFeelingsReason').value.trim();
            if (!myReason) {
                alert('ê°ì •ì˜ ì´ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            myResponse = {
                moods: selectedMoods.map(mood => ({
                    mood: mood,
                    korean: moodData[mood].kr
                })),
                reason: myReason
            };
            
            alert('ë‚˜ì˜ ê°ì •ì„ ì¹œêµ¬ì—ê²Œ ë³´ëƒˆìŠµë‹ˆë‹¤! ì´ì œ ê²°ê³¼ë¥¼ í™•ì¸í•´ ë³¼ê¹Œìš”? âœ¨');

            // ì‘ë‹µìê°€ ì‘ë‹µì„ ë³´ë‚´ë©´ ì˜ˆì¸¡ìëŠ” ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                showResults(); // ë°”ë¡œ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™
            }, 1000);
        }

        function showResults() {
            const container = document.getElementById('resultsContent');
            container.innerHTML = ''; // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
            
            // ë§¤ì¹­ í™•ì¸ ë¡œì§ (ë‚´ê°€ ì‘ë‹µìì¼ ë•Œ ì¹œêµ¬ì˜ ì˜ˆì¸¡ê³¼ ë‚´ ê°ì •ì„ ë¹„êµ)
            const matches = partnerPredictions.map(pred => {
                const isMatch = myResponse.moods.some(m => m.mood === pred.mood);
                return { ...pred, isMatch };
            });
            
            const correctCount = matches.filter(m => m.isMatch).length;
            
            container.innerHTML = `
                <div class="prediction-section">
                    <h3>ğŸ¯ ì¹œêµ¬ì˜ ì˜ˆì¸¡ ê²°ê³¼ (${correctCount}/3 ë§ìŒ)</h3>
                    <p>ì¹œêµ¬ê°€ ë‹¹ì‹ ì˜ ê°ì •ì„ ${correctCount}ê°œ ë§ì·„ì–´ìš”!</p>
                    ${matches.map(match => `
                        <div class="prediction-item">
                            <span>ì¹œêµ¬ì˜ ì˜ˆì¸¡: <strong>You look ${match.mood}</strong> (${match.korean})</span>
                            <span class="match-indicator ${match.isMatch ? 'match-correct' : 'match-incorrect'}">
                                ${match.isMatch ? 'âœ“ ë§ìŒ!' : 'âœ— í‹€ë¦¼'}
                            </span>
                            <p style="margin-top: 5px; color: #666;"><em>(ì¹œêµ¬ì˜ ì´ìœ : because ${match.reason})</em></p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="response-section">
                    <h3>ğŸ’ ë‚˜ì˜ ì‹¤ì œ ê°ì •</h3>
                    <p><strong>ë‚˜ëŠ” ì§€ê¸ˆ:</strong> ${myResponse.moods.map(m => `${m.mood} (${m.korean})`).join(', ')}</p>
                    <p style="margin-top: 10px;"><strong>because</strong> ${myResponse.reason}</p>
                </div>
            `;
            
            // ì‘ì› ë©”ì‹œì§€ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ë° ë²„íŠ¼ í™œì„±í™”
            document.getElementById('supportMessage').value = '';
            document.getElementById('sendSupportBtn').disabled = false;

            showScreen('resultsScreen');
        }

        function sendSupport() {
            const message = document.getElementById('supportMessage').value.trim();
            if (!message) {
                alert('ì‘ì› ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            alert('ì‘ì› ë©”ì‹œì§€ë¥¼ ì¹œêµ¬ì—ê²Œ ë³´ëƒˆìŠµë‹ˆë‹¤! ğŸ’•');
            
            // ë©”ì‹œì§€ ì „ì†¡ í›„ UI ì—…ë°ì´íŠ¸
            const supportDiv = document.querySelector('#resultsScreen .support-message');
            if (supportDiv) {
                supportDiv.innerHTML = `
                    <h3>ğŸ’™ ì‘ì› ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ!</h3>
                    <p>ì¹œêµ¬ì—ê²Œ ë”°ëœ»í•œ ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    <p style="font-style: italic; color: #555;">"${message}"</p>
                    <p style="margin-top: 15px;">ì„œë¡œì˜ ê°ì •ì„ ì´í•´í•˜ëŠ” ì‹œê°„ì„ ê°€ì¡Œì–´ìš”. ë‹¤ìŒì—ë„ í•¨ê»˜í•´ìš”!</p>
                `;
            }
        }

        function startNewChat() {
            // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
            currentRoom = '';
            selectedMoods = [];
            predictions = [];
            isPredictor = true; 
            partnerPredictions = [];
            myResponse = {};

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('roomCodeInput').value = '';
            document.getElementById('myFeelingsReason').value = '';
            document.getElementById('supportMessage').value = '';

            // UI ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('connectionStatus').innerHTML = 'ğŸŸ¢ Ready to Connect';
            updateSelectionUI('moodGrid'); // ì„ íƒ ê°œìˆ˜ 0ìœ¼ë¡œ
            document.getElementById('continueBtn').disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”

            showScreen('roomCodeScreen'); // ì²« í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        }

        // ì•± ì‹œì‘ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            showScreen('roomCodeScreen');
            // ì˜ˆì¸¡ì/ì‘ë‹µì ì—­í• ì— ë”°ë¼ ì´ˆê¸° í™”ë©´ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë„ë¡ joinRoomì—ì„œ ì—­í•  í• ë‹¹ í›„ í™”ë©´ ì „í™˜
            // ì´ˆê¸°ì—ëŠ” ë‹¨ìˆœíˆ RoomCodeScreenì„ ë³´ì—¬ì¤Œ
        });
    </script>
</body>
</html>